{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.2", "generated_at": "2025-06-09T14:47:58.668232Z", "invocation_id": "f9cce08f-b51a-4988-bb95-cc43fed7ca25", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-09T14:47:22.335186Z", "completed_at": "2025-06-09T14:47:22.345660Z"}, {"name": "execute", "started_at": "2025-06-09T14:47:22.345963Z", "completed_at": "2025-06-09T14:47:23.499616Z"}], "thread_id": "Thread-1", "execution_time": 1.165215015411377, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "first-project-262802", "job_id": "d858cfa7-ad29-4bf0-9d96-a6b859829a0f", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.stock_analysis.base_polygon_stock_histories_1m", "compiled": true, "compiled_code": "\n\n\nwith unioned_data as (\n\n    select * from `first-project-262802`.`stock`.`polygon_all_different_stock_histories_1m_etl_date_2025_04_17`\n\n    union all\n\n    select * from `first-project-262802`.`stock`.`polygon_all_different_stock_histories_1m_elt_date_2025_06_09`\n\n)\n\n\n\nselect\n    datetime_est\n    , date(datetime_est) as date\n    , time(datetime_est) as time\n    , extract (hour from datetime_est ) as hour\n    , extract (minute from datetime_est ) as minute\n    , open\n    , high\n    , low\n    , close\n    , volume\n    , transactions\n    , vwap\n    , date(ETL_Date) as etl_date\n    , Symbol as symbol\nfrom unioned_data", "relation_name": "`first-project-262802`.`stock_analysis`.`base_polygon_stock_histories_1m`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-09T14:47:23.503559Z", "completed_at": "2025-06-09T14:47:23.506950Z"}, {"name": "execute", "started_at": "2025-06-09T14:47:23.507218Z", "completed_at": "2025-06-09T14:47:24.681909Z"}], "thread_id": "Thread-3", "execution_time": 1.1792628765106201, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "first-project-262802", "job_id": "a20fd138-b9e2-4fe1-b53e-8ccb224e820d", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.stock_analysis.stg_polygon_stock_histories_1m", "compiled": true, "compiled_code": "\n\nwith \n\nstock as ( select * from `first-project-262802`.`stock_analysis`.`base_polygon_stock_histories_1m` )\n\n, calendar as ( select * from `first-project-262802`.`stock_analysis`.`stg_calendar` )\n\n, base as \n(\n    select \n        *\n        , round(((open + close + high + low)/4.00),2) as avg_minute_price\n        , case when cast( concat(hour,'.',trim( CAST( minute AS STRING FORMAT '00') )) as numeric ) >= 9.30 and cast( concat(hour,'.',trim( CAST( minute AS STRING FORMAT '00') )) as numeric ) < 16.0 then 1 else 0 end as minute_within_regular_trading_hours\n        , case when cast( concat(hour,'.',trim( CAST( minute AS STRING FORMAT '00') )) as numeric ) < 9.30 then 1 else 0 end as minute_within_pre_market_trading_hours\n        , case when cast( concat(hour,'.',trim( CAST( minute AS STRING FORMAT '00') )) as numeric ) >= 16.0 then 1 else 0 end as minute_within_post_market_trading_hours\n        , case\n            when cast( concat(hour,'.',trim( CAST( minute AS STRING FORMAT '00') )) as numeric ) >= 9.30 and cast( concat(hour,'.',trim( CAST( minute AS STRING FORMAT '00') )) as numeric ) < 16.0 then 'minute_within_regular_trading_hours'\n            when cast( concat(hour,'.',trim( CAST( minute AS STRING FORMAT '00') )) as numeric ) < 9.30 then 'minute_within_pre_market_trading_hours'\n            when cast( concat(hour,'.',trim( CAST( minute AS STRING FORMAT '00') )) as numeric ) >= 16.0 then 'minute_within_post_market_trading_hours'\n            else NULL\n        end as minute_in_pre_market_regular_market_post_market_hours\n    from stock\n    left join calendar using (date)\n)\n\nselect * from base", "relation_name": "`first-project-262802`.`stock_analysis`.`stg_polygon_stock_histories_1m`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-09T14:47:24.686193Z", "completed_at": "2025-06-09T14:47:24.693365Z"}, {"name": "execute", "started_at": "2025-06-09T14:47:24.693760Z", "completed_at": "2025-06-09T14:47:26.016436Z"}], "thread_id": "Thread-5", "execution_time": 1.3312630653381348, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "first-project-262802", "job_id": "78ce5f69-bde1-4df5-90f2-1d3835fa615e", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.stock_analysis.int_stock_analysis_1m", "compiled": true, "compiled_code": "\n\nwith base as \n(\n    select \n        * \n    from `first-project-262802`.`stock_analysis`.`stg_polygon_stock_histories_1m`\n)\n\n-- -- -- got the following from here: https://medium.com/google-cloud/how-to-calculate-technical-indicators-in-bigquery-using-sql-moving-averages-rsi-macd-b58b16e4f52e\n\n, prices AS (\n  SELECT \n    symbol,\n    date, hour, minute,\n    open,\n    high,\n    low,\n    close,\n    volume,\n    AVG(close) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS ma7,\n    AVG(close) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS ma30,\n    AVG(close) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 99 PRECEDING AND CURRENT ROW) AS ma100,\n    AVG(close) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 199 PRECEDING AND CURRENT ROW) AS ma200,\n    SUM(CASE WHEN close > open THEN close - open ELSE 0 END) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS gain_14,\n    SUM(CASE WHEN open > close THEN open - close ELSE NULL END) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS loss_14,\n    SUM(CASE WHEN close > open THEN close - open ELSE 0 END) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 23 PRECEDING AND CURRENT ROW) AS gain_24,\n    SUM(CASE WHEN open > close THEN open - close ELSE NULL END) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 23 PRECEDING AND CURRENT ROW) AS loss_24,\n    MAX(high) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 23 PRECEDING AND CURRENT ROW) AS highest,\n    MIN(low) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 23 PRECEDING AND CURRENT ROW) AS lowest,\n    (AVG(close) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) - AVG(close) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 23 PRECEDING AND CURRENT ROW)) AS macd\n  FROM base\n)\n\n, indicators AS (\n  SELECT \n    symbol,\n    close,\n    volume,\n    date, hour, minute,\n    ma7,\n    ma30,\n    ma100,\n    ma200,\n    (100 - (100 / (1 + (gain_14 / loss_14)))) AS rsi_14,\n    (100 - (100 / (1 + (gain_24 / loss_24)))) AS rsi_24,\n    macd,\n    (CASE WHEN STDDEV_POP(close) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 23 PRECEDING AND CURRENT ROW) = 0 THEN NULL ELSE ((close - AVG(close) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 23 PRECEDING AND CURRENT ROW)) / STDDEV_POP(close) OVER (PARTITION BY symbol ORDER BY date, hour, minute ROWS BETWEEN 23 PRECEDING AND CURRENT ROW)) END) AS bollinger_band\n  FROM prices\n)\n\n, final_indicator_values as (\nSELECT \n  symbol,\n--   close,\n--   volume,\n  date, hour, minute,\n  ma7,\n  ma30,\n  ma100,\n  ma200,\n  rsi_14,\n  rsi_24,\n  macd,\n  bollinger_band,\n  ABS(ma200 - close) ma200_reach,\n  ABS(ma100 - close) ma100_reach,\n  ABS(ma30 - close) ma30_reach,\n  ABS(ma7 - close) ma7_reach\nFROM indicators\n)\n\n\nselect \n    *\nfrom base\nleft join final_indicator_values using (symbol, date, hour, minute)", "relation_name": "`first-project-262802`.`stock_analysis`.`int_stock_analysis_1m`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-09T14:47:26.021996Z", "completed_at": "2025-06-09T14:47:26.027547Z"}, {"name": "execute", "started_at": "2025-06-09T14:47:26.027932Z", "completed_at": "2025-06-09T14:47:58.664115Z"}], "thread_id": "Thread-7", "execution_time": 32.643173933029175, "adapter_response": {"_message": "CREATE TABLE (26.6m rows, 1015.2 MiB processed)", "code": "CREATE TABLE", "rows_affected": 26556312, "bytes_processed": 1064516156, "bytes_billed": 1065353216, "location": "US", "project_id": "first-project-262802", "job_id": "1950ecd2-c864-470e-af8b-921b4b31d1ce", "slot_ms": 3315465}, "message": "CREATE TABLE (26.6m rows, 1015.2 MiB processed)", "failures": null, "unique_id": "model.stock_analysis.stock_analysis_1m", "compiled": true, "compiled_code": "\n\n\nselect \n    *\nfrom `first-project-262802`.`stock_analysis`.`int_stock_analysis_1m`", "relation_name": "`first-project-262802`.`stock_analysis`.`stock_analysis_1m`"}], "elapsed_time": 37.49402213096619, "args": {"log_format_file": "debug", "log_level_file": "debug", "exclude": [], "indirect_selection": "eager", "log_format": "default", "macro_debugging": false, "strict_mode": false, "print": true, "version_check": true, "which": "run", "write_json": true, "log_file_max_bytes": 10485760, "warn_error_options": {"include": [], "exclude": []}, "source_freshness_run_project_hooks": false, "project_dir": "/Users/ahmed/Desktop/dbt/stock_analysis", "use_colors_file": true, "log_level": "info", "partial_parse_file_diff": true, "show_resource_report": false, "enable_legacy_logger": false, "partial_parse": true, "printer_width": 80, "require_resource_names_without_spaces": false, "use_colors": true, "require_explicit_package_overrides_for_builtin_materializations": true, "favor_state": false, "populate_cache": true, "empty": false, "profiles_dir": "/Users/ahmed/.dbt", "vars": {}, "log_path": "/Users/ahmed/Desktop/dbt/stock_analysis/logs", "cache_selected_only": false, "send_anonymous_usage_stats": true, "select": ["base_polygon_stock_histories_1m+"], "static_parser": true, "defer": false, "quiet": false, "invocation_command": "dbt run --select base_polygon_stock_histories_1m+", "introspect": true}}